/* eslint-disable no-unused-vars */

'use strict';

const fs = require('fs');
const { Op } = require('sequelize');
const { USR_Role, USR_RoleFeature, USR_Feature } = require('../models');

/** @type {import('sequelize-cli').Migration} */
module.exports = {
  async up(queryInterface, Sequelize) {
    let helpdeskRole = await USR_Role.findOne({
      where: { name: { [Op.substring]: 'Helpdesk' } },
      include: { model: USR_Feature, attributes: ['id'], through: { attributes: [] } },
    });
    if (!helpdeskRole) {
      helpdeskRole = await USR_Role.create({
        templateId: 1,
        name: 'Helpdesk',
      });
    }
    // if (helpdeskRole) {
    const newFeatures = await USR_Feature.findAll({
      where: {
        name: {
          [Op.in]: [
            'View Role',
            'View User',
            'Create User',
            'Update User',
            'Delete User',
            'Change Password',
            'View Participant',
            'Create Participant',
            'Update Participant',
            'Track Participant',
            'View Contingent',
            'Create Contingent',
            'Update Contingent',
            'View Group',
            'Create Group',
            'Update Group',
            'Delete Group',
            'View Location',
            'Update Location',
            'View Facility',
            'View Room',
            'View Vehicle',
            'View Driver',
            'View Vendor',
            'View Vehicle Schedule',
            'Create Vehicle Schedule',
            'Update Vehicle Schedule',
            'Delete Vehicle Schedule',
            'View Menu',
            'View Kitchen',
            'View Kitchen Target',
            'View Courier',
            'View FNB Schedule',
            'View Event',
            'View Chatbot Response',
            'Create Chatbot Response',
            'Update Chatbot Response',
            'Delete Chatbot Response',
            'Activate Chatbot Response',
            'View Feedback',
            'Create Feedback',
            'Update Feedback',
            'Delete Feedback',
            'View FAQ',
            'Create FAQ',
            'Update FAQ',
            'Delete FAQ',
            'View Broadcast Template',
            'Create Broadcast Template',
            'Update Broadcast Template',
            'Delete Broadcast Template',
            'View Broadcast',
            'Create Broadcast',
            'Update Broadcast',
            'Delete Broadcast',
            'View Information Center',
            'Create Information Center',
            'Update Information Center',
            'Delete Information Center',
            'View Participant Type',
            'View Identity Type',
            'View Region',
            'View Group Status',
            'View Location Type',
            'View Room Type',
            'Create Room Type',
            'View Room Status',
            'View Lodger Status',
            'View Event Category',
            'View Vehicle Type',
            'View Vehicle Category',
            'View Vehicle Schedule Status',
            'View Passenger Status',
            'View Food Type',
            'View FNB Schedule Status',
            'View Feedback Type',
            'View Feedback Target',
            'View Feedback Status',
            'View FAQ Type',
            'Create FAQ Type',
            'Update FAQ Type',
            'Delete FAQ Type',
            'View Chatbot Response Type',
            'Create Chatbot Response Type',
            'Update Chatbot Response Type',
            'Delete Chatbot Response Type',
            'View Broadcast Template Category',
            'Create Broadcast Template Category',
            'Update Broadcast Template Category',
            'Delete Broadcast Template Category',
            'View Broadcast Template Header Type',
            'Create Broadcast Template Header Type',
            'Update Broadcast Template Header Type',
            'Delete Broadcast Template Header Type',
            'View Meta Template Category',
            'Create Meta Template Category',
            'Update Meta Template Category',
            'Delete Meta Template Category',
            'View PIC Type',
            'View PIC',
            'Create PIC',
            'Update PIC',
            'Delete PIC',
            'View Dashboard',
            'View Lodger',
            'Create Lodger',
            'Update Lodger',
            'Delete Lodger',
            'Create Participant Committee',
            'Update Participant Committee',
            'View Committee Type',
            'Create Committee Type',
            'Update Committee Type',
            'Delete Committee Type',
            'Absent Vehicle Schedule',
            'View FNB Schedule Menu',
            'View Participant Committee',
            'View Bed Type',
            'View Participant Document',
            'View Menu Type',
            'View Arrival Departure',
            'Create Arrival Departure',
            'Update Arrival Departure',
            'Delete Arrival Departure',
          ],
        },
      },
      attributes: ['id'],
    });

    const existFeatures = helpdeskRole.USR_Features
      ? helpdeskRole.USR_Features
      : [].map((feature) => feature.id);
    const newNonExistFeatures = newFeatures.filter(
      (feature) => !existFeatures?.includes(feature.id),
    );

    const newRoleFeatures = newNonExistFeatures.map((feature) => ({
      roleId: helpdeskRole.id,
      featureId: feature.id,
    }));

    await USR_RoleFeature.bulkCreate(newRoleFeatures);
    // }
  },

  async down(queryInterface, Sequelize) {
    let helpdeskRole = await USR_Role.findOne({
      where: { name: { [Op.substring]: 'Helpdesk' } },
      include: { model: USR_Feature, attributes: ['id'], through: { attributes: [] } },
    });
    if (!helpdeskRole) {
      helpdeskRole = await USR_Role.create({
        templateId: 1,
        name: 'Helpdesk',
      });
    }

    // if (helpdeskRole) {
    const newFeatures = await USR_Feature.findAll({
      where: {
        name: {
          [Op.in]: [
            'View Role',
            'View User',
            'Create User',
            'Update User',
            'Delete User',
            'Change Password',
            'View Participant',
            'Create Participant',
            'Update Participant',
            'Track Participant',
            'View Contingent',
            'Create Contingent',
            'Update Contingent',
            'View Group',
            'Create Group',
            'Update Group',
            'Delete Group',
            'View Location',
            'Update Location',
            'View Facility',
            'View Room',
            'View Vehicle',
            'View Driver',
            'View Vendor',
            'View Vehicle Schedule',
            'Create Vehicle Schedule',
            'Update Vehicle Schedule',
            'Delete Vehicle Schedule',
            'View Menu',
            'View Kitchen',
            'View Kitchen Target',
            'View Courier',
            'View FNB Schedule',
            'View Event',
            'View Chatbot Response',
            'Create Chatbot Response',
            'Update Chatbot Response',
            'Delete Chatbot Response',
            'Activate Chatbot Response',
            'View Feedback',
            'Create Feedback',
            'Update Feedback',
            'Delete Feedback',
            'View FAQ',
            'Create FAQ',
            'Update FAQ',
            'Delete FAQ',
            'View Broadcast Template',
            'Create Broadcast Template',
            'Update Broadcast Template',
            'Delete Broadcast Template',
            'View Broadcast',
            'Create Broadcast',
            'Update Broadcast',
            'Delete Broadcast',
            'View Information Center',
            'Create Information Center',
            'Update Information Center',
            'Delete Information Center',
            'View Participant Type',
            'View Identity Type',
            'View Region',
            'View Group Status',
            'View Location Type',
            'View Room Type',
            'Create Room Type',
            'View Room Status',
            'View Lodger Status',
            'View Event Category',
            'View Vehicle Type',
            'View Vehicle Category',
            'View Vehicle Schedule Status',
            'View Passenger Status',
            'View Food Type',
            'View FNB Schedule Status',
            'View Feedback Type',
            'View Feedback Target',
            'View Feedback Status',
            'View FAQ Type',
            'Create FAQ Type',
            'Update FAQ Type',
            'Delete FAQ Type',
            'View Chatbot Response Type',
            'Create Chatbot Response Type',
            'Update Chatbot Response Type',
            'Delete Chatbot Response Type',
            'View Broadcast Template Category',
            'Create Broadcast Template Category',
            'Update Broadcast Template Category',
            'Delete Broadcast Template Category',
            'View Broadcast Template Header Type',
            'Create Broadcast Template Header Type',
            'Update Broadcast Template Header Type',
            'Delete Broadcast Template Header Type',
            'View Meta Template Category',
            'Create Meta Template Category',
            'Update Meta Template Category',
            'Delete Meta Template Category',
            'View PIC Type',
            'View PIC',
            'Create PIC',
            'Update PIC',
            'Delete PIC',
            'View Dashboard',
            'View Lodger',
            'Create Lodger',
            'Update Lodger',
            'Delete Lodger',
            'Create Participant Committee',
            'Update Participant Committee',
            'View Committee Type',
            'Create Committee Type',
            'Update Committee Type',
            'Delete Committee Type',
            'Absent Vehicle Schedule',
            'View FNB Schedule Menu',
            'View Participant Committee',
            'View Bed Type',
            'View Participant Document',
            'View Menu Type',
            'View Arrival Departure',
            'Create Arrival Departure',
            'Update Arrival Departure',
            'Delete Arrival Departure',
          ],
        },
      },
      attributes: ['id'],
    });

    const features = newFeatures.map((feature) => feature.id);

    await USR_RoleFeature.destroy({
      where: { roleId: helpdeskRole.id, featureId: { [Op.in]: features } },
    });
    // }
  },
};
